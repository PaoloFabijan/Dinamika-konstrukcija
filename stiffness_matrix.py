import numpy as np

##########################
# Ulazni parametri (m, Pa)
##########################

L1 = 0.32
L2 = 0.64
b = 0.003
h = 0.04
I = (b**3*h)/12
E = 8.6E10

#########################################
# Lokalne matrice krutosti grede s 3 mase
#########################################

k1 = ((E*I)/L1**3) * np.array([[12, 6*L1, -12, 6*L1], 
                               [6*L1, 4*L1**2, -6*L1, 2*L1**2],
                               [-12, -6*L1, 12, -6*L1],
                               [6*L1, 2*L1**2, -6*L1, 4*L1**2]])

k2 = ((E*I)/L2**3) * np.array([[12, 6*L2, -12, 6*L2], 
                               [6*L2, 4*L2**2, -6*L2, 2*L2**2],
                               [-12, -6*L2, 12, -6*L2],
                               [6*L2, 2*L2**2, -6*L2, 4*L2**2]])

k3 = ((E*I)/L2**3) * np.array([[12, 6*L2, -12, 6*L2], 
                               [6*L2, 4*L2**2, -6*L2, 2*L2**2],
                               [-12, -6*L2, 12, -6*L2],
                               [6*L2, 2*L2**2, -6*L2, 4*L2**2]])

k4 = ((E*I)/L1**3) * np.array([[12, 6*L1, -12, 6*L1], 
                               [6*L1, 4*L1**2, -6*L1, 2*L1**2],
                               [-12, -6*L1, 12, -6*L1],
                               [6*L1, 2*L1**2, -6*L1, 4*L1**2]])

###################################
# Globalna matrica krutosti sustava
###################################

K = np.zeros([10, 10])

for i in range(10):
    K[0:2, 0:4] = k1[0:2, 0:4]
    K[0:4, 0:2] = k1[0:4, 0:2]
    K[8:10, 6:10] = k4[2:4, 0:4]
    K[6:10, 8:10] = k4[0:4, 2:4]

    if i >= 2 and i <= 4:
        for i in range(2, 4, 2):
            K[i:i+2,i:i+2] = k1[2:4,2:4] + k2[0:2,0:2]
            K[i+2:i+4,i:i+2] = k2[2:4,0:2]
            K[i:i+2,i+2:i+4] = k2[0:2,2:4]
    
    if i >= 4 and i <= 6:
        for i in range(4, 6, 2):
            K[i:i+2,i:i+2] = k2[2:4,2:4] + k3[0:2,0:2]
            K[i+2:i+4,i:i+2] = k3[2:4,0:2]
            K[i:i+2,i+2:i+4] = k3[0:2,2:4]
    
    if i >= 6 and i <= 8:
        for i in range(6, 8, 2):
            K[i:i+2,i:i+2] = k3[2:4,2:4] + k4[0:2,0:2]
            K[i+2:i+4,i:i+2] = k4[2:4,0:2]
            K[i:i+2,i+2:i+4] = k4[0:2,2:4]

# np.savetxt('Matrica_krutosti.csv', K, delimiter=',')